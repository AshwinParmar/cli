language: php
os: linux
version: ~> 1.0
php:
  - 7.3
  - 7.4

cache:
  directories:
    - "$HOME/.composer/cache"

services:
  - mysql

env:
  global: ADS_PRINT_COMMAND_OUTPUT=1
  # @see https://pantheon.io/blog/highest-lowest-testing-multiple-symfony-versions
  matrix:
    - 'HIGHEST_LOWEST="update"'
    - 'HIGHEST_LOWEST="update --prefer-lowest"'

jobs:
  # We have to explicitly add Windows jobs because Travis CI doesn't support PHP on Windows.
  include:
    - os: windows
      language: bash
      before_install:
        - git clone git://github.com/phpenv/phpenv.git ~/.phpenv
        - export PATH="$HOME/.phpenv/libexec:$PATH"
        - eval "$(phpenv init -)"
        - git clone https://github.com/php-build/php-build $(phpenv root)/plugins/php-build
        - phpenv help
        - phpenv versions
        - phpenv install 7.3.17
        - phpenv rehash
        - php -v
        - php -i

before_install:
  - composer selfupdate

install:
  # Load composer dependencies.
  - composer validate --no-check-all --ansi
  - 'composer -n ${HIGHEST_LOWEST-install} --prefer-dist -o'
  - ./bin/ads auth:login --key=notarealkeyatall --secret=thisisaplaceholder

script:
  - composer test

after_success:
  - ./vendor/bin/php-coveralls -vvv
